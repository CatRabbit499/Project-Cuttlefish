<link rel="import" href="/components/polymer/polymer.html">
<pc-loader target='["iron-media-query","paper-header-panel","pc-sidebar","pc-navbar","pc-login-view","pc-student-schedule-view"]'></pc-loader>
<dom-module id="pc-stage">
	<link rel="import" type="css" href="pc-stage.css"/>
	<template>
		<iron-media-query query="(max-width: 768px)" query-matches="{{mobile}}"></iron-media-query>
		<div id="drawer" style$="[[_getDrawerStyle(drawerWidth)]]">
			<pc-sidebar class$="[[_getDrawerClasses(drawerPeeking, mobile)]]" style$="[[_getDrawerStyle(drawerWidth)]]" open$="{{open}}"></pc-sidebar>
		</div>
		<div id="mainWrapper">
			<paper-header-panel id="main">
				<pc-navbar brand$="{{brand}}" title$="{{title}}" mobile$="[[mobile]]" class="paper-toolbar">
					<paper-icon-button class="navbar-header-item" icon="menu" style="color: white;" on-tap="toggleDrawer"></paper-icon-button>
				</pc-navbar>
				<div main>
					<pc-login-view class="xview" id="login"></pc-login-view>
					<pc-student-schedule-view class="xview" id="schedule"></pc-student-schedule-view>
				</div>
			</paper-header-panel>
			<div id="scrim" on-tap="closeDrawer"></div>
		</div>
	</template>
	
	<script>
		Polymer({
			is: "pc-stage",
			
			properties: {
				brand: {
					type: String,
					value: 'Project Cuttlefish',
				},
				drawerPeeking: {
					type: Boolean,
					readOnly: true,
					value: false,
					notify: true
				},
				drawerWidth: {
					type: String,
					value: '250px'
				},
				mobile: {
					tyle: Boolean,
					notify: true,
					reflectToAttribute: true,
					observer: '_mobileUpdate'
				},
				narrow: {
					type: Boolean,
					value: false,
					notify: true,
					reflectToAttribute: true
				},
				title: {
					type: String,
					value: 'Home'
				},
				open: {
					type: Boolean,
					value: false,
					notify: true,
					reflectToAttribute: true
				}
			},
			listeners: {
			},
			ready: function() {
				window.bar = this;
				/* Get dom-bind to work, to facilitate runtime loading of views */
				$(this.$.views).on('dom-change', function(e) {
					console.log('dom bind working!',e);
				});
			},
			
			_getDrawerClasses: function(drawerPeeking, mobile) {
				return (mobile?"mobile ":"") + (drawerPeeking?"peeking":"");
			},
			_getDrawerStyle: function(drawerWidth) {
				return "width: "+drawerWidth;
			},
			toggleDrawer() {
				this.open = !this.open;
			},
			closeDrawer() {
				this.open = false;
			},
			loadView(name, element) {
				//$('head').append($('<link/>').attr({rel:'import',href:element}));
				$(this)
					.find('div[main]')
					.append($('<'+element+'/>')
						.addClass('xview stage-mobile-observer')
						.attr({'id':name}));
			},
			showView(name) {
				var $views = $(this).find('.xview');
				$views.filter('[active]:not(#'+name+')').removeAttr('active');//TODO fix for possible injection
				$views.filter('#'+name).attr('active','');
				//TODO transition code
			},
			_mobileUpdate(is,was) {
				var observers = $('.stage-mobile-observer');
				if (is) {
					observers.attr('mobile','');
				} else {
					observers.removeAttr('mobile');
				}
			}
		});
	</script>
</dom-module>